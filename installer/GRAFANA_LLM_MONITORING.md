# üìä Grafana –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ LLM –≤ TERAG

## –û–±–∑–æ—Ä

TERAG —Ç–µ–ø–µ—Ä—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ LLM –≤ Prometheus, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤ Grafana –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

## üéØ –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å
- **terag_llm_model_current** - –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ–π—á–∞—Å

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **terag_llm_duration_seconds** - –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ LLM (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞)
- **terag_llm_requests_total** - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∏–ø—É –∑–∞–¥–∞—á–∏ –∏ –º–æ–¥–µ–ª–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **terag_task_types_total** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∏–ø—É –∑–∞–¥–∞—á–∏
- **terag_llm_model_switches_total** - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π

### –£—Å–ø–µ—à–Ω–æ—Å—Ç—å
- **terag_llm_requests_total{status="success"}** - —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **terag_llm_requests_total{status="error"}** - –æ—à–∏–±–∫–∏

### –ö–æ–¥–∏—Ä–æ–≤–∫–∞
- **terag_llm_encoding_errors_total** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8 (—Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –º–æ–¥–µ–ª–∏ –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É)
  - –ú–µ—Ç—Ä–∏–∫–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ TERAG –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –±–∏—Ç—ã–µ –±–∞–π—Ç—ã –∏–∑ Ollama
  - –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –∏ –¥—Ä—É–≥–∏—Ö Unicode-—Å–∏–º–≤–æ–ª–æ–≤

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ Prometheus

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã:

```powershell
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus
curl http://localhost:9090/api/v1/query?query=terag_llm_requests_total
```

### 2. –û—Ç–∫—Ä—ã—Ç—å Grafana

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
2. –í–æ–π–¥–∏—Ç–µ (admin / terag_admin)
3. –î–∞—à–±–æ—Ä–¥ "TERAG LLM Monitoring" –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 3. –ï—Å–ª–∏ –¥–∞—à–±–æ—Ä–¥ –Ω–µ –ø–æ—è–≤–∏–ª—Å—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Dashboards** ‚Üí **Browse**
2. –ù–∞–π–¥–∏—Ç–µ –ø–∞–ø–∫—É **TERAG**
3. –û—Ç–∫—Ä–æ–π—Ç–µ **TERAG LLM Monitoring**

## üìà –ü–∞–Ω–µ–ª–∏ –¥–∞—à–±–æ—Ä–¥–∞

### 1. Current LLM Model
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é –º–æ–¥–µ–ª—å LLM –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

### 2. LLM Response Time
–ì—Ä–∞—Ñ–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞ LLM:
- P95 (95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å) - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- P50 (–º–µ–¥–∏–∞–Ω–∞) - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞

–†–∞–∑–±–∏–≤–∫–∞ –ø–æ:
- –¢–∏–ø—É –∑–∞–¥–∞—á–∏ (code, analysis, reasoning, general)
- –ú–æ–¥–µ–ª–∏ (qwen3-coder, llama3, –∏ —Ç.–¥.)

### 3. Requests by Task Type
–ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∏–ø–∞–º –∑–∞–¥–∞—á:
- CODE
- ANALYSIS
- REASONING
- GENERAL

### 4. LLM Requests Rate
–ì—Ä–∞—Ñ–∏–∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (requests/sec) –ø–æ:
- –¢–∏–ø—É –∑–∞–¥–∞—á–∏
- –ú–æ–¥–µ–ª–∏

### 5. LLM Success Rate
–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∏–ø–∞–º –∑–∞–¥–∞—á:
- –ó–µ–ª—ë–Ω—ã–π: >95%
- –ñ—ë–ª—Ç—ã–π: 90-95%
- –ö—Ä–∞—Å–Ω—ã–π: <90%

### 6. Model Switches
–ì—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —á–∞—Å—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
- –§–æ—Ä–º–∞—Ç: `from_model ‚Üí to_model`

## üîç –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ Prometheus

### –¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å
```promql
label_replace(terag_llm_model_current == 1, "model", "$1", "model", "(.+)")
```

### –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –ø–æ –∑–∞–¥–∞—á–µ
```promql
histogram_quantile(0.50, sum(rate(terag_llm_duration_seconds_bucket[5m])) by (le, task_type))
```

### –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–æ –º–æ–¥–µ–ª–∏
```promql
sum(rate(terag_llm_requests_total{status="success"}[5m])) by (model) 
/ 
sum(rate(terag_llm_requests_total[5m])) by (model) * 100
```

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –º–æ–¥–µ–ª–µ–π
```promql
sum(rate(terag_llm_model_switches_total[5m])) by (from_model, to_model)
```

### –û—à–∏–±–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –ø–æ –º–æ–¥–µ–ª–∏
```promql
sum(rate(terag_llm_encoding_errors_total[5m])) by (model, provider)
```

### –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
```promql
sum(terag_llm_encoding_errors_total)
```

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ –≤ Grafana
2. –ù–∞–∂–º–∏—Ç–µ **Edit**
3. –ù–∞–∂–º–∏—Ç–µ **Add panel**
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PromQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–µ—Ç—Ä–∏–∫ TERAG

### –ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —á–∞—Å–æ–≤ (‚è±Ô∏è) –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
3. –í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 —Å–µ–∫—É–Ω–¥)

## üìä –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ –≤—ã—Å–æ–∫–æ–µ (>5 —Å–µ–∫—É–Ω–¥)
- –í–æ–∑–º–æ–∂–Ω–æ, –º–æ–¥–µ–ª—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è –¥–ª—è –∑–∞–¥–∞—á–∏
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –±–æ–ª–µ–µ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—É—é –º–æ–¥–µ–ª—å

### –ú–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –º–æ–¥–µ–ª–µ–π
- –°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–æ –ø–æ–¥–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

### –ù–∏–∑–∫–∏–π success rate (<90%)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs terag-api`
- –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Ollama
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `curl http://localhost:8000/llm/health`

### –û–¥–∏–Ω —Ç–∏–ø –∑–∞–¥–∞—á–∏ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å –æ–¥–Ω–∏–º —Ç–∏–ø–æ–º –∑–∞–¥–∞—á
- –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –º–æ–¥–µ–ª–µ–π –≤ `llm_client.py`

### –ú–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ (>10 –∑–∞ —á–∞—Å)
- Ollama –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏—Ç—ã–µ –±–∞–π—Ç—ã UTF-8
- TERAG –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö, –Ω–æ —ç—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Ollama –∏ –º–æ–¥–µ–ª—å
- –ú–µ—Ç—Ä–∏–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ `/health` endpoint: `curl http://localhost:8000/health`

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Auto Model Switching](AUTO_MODEL_SWITCHING.md) - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
- [Prometheus Configuration](../prometheus/prometheus.yml) - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
- [TERAG API Documentation](http://localhost:8000/docs) - API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è


