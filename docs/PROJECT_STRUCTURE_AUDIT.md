# 📊 Аудит Структуры Проекта TERAG

**Дата:** 2026-01-06  
**Версия:** 1.0  
**Статус:** Полный анализ структуры проекта

---

## 📋 Executive Summary

### Общая оценка: **75/100** ⚠️

**Сильные стороны:**
- ✅ Четкое разделение на слои (API, Core, Components)
- ✅ Хорошая организация основных модулей
- ✅ Наличие документации
- ✅ Правильная структура тестов

**Критические проблемы:**
- ❌ **Много файлов в корне проекта** (100+ файлов)
- ❌ **Дублирование модулей** (kag_builder в разных местах)
- ❌ **Смешанная структура** (src/ + installer/app/)
- ❌ **Неорганизованные скрипты** (test_*, setup_*, check_* в корне)
- ❌ **Избыточная документация в корне** (50+ .md файлов)

---

## 🏗️ Текущая Структура Проекта

### ✅ Правильно организованные директории

```
TERAG111-1/
├── src/                    ✅ Основной код
│   ├── api/               ✅ API слой (FastAPI)
│   │   ├── routes/        ✅ Роутеры
│   │   ├── middleware/    ✅ Middleware
│   │   └── models/        ✅ Pydantic модели
│   ├── core/              ✅ Бизнес-логика
│   │   ├── agents/        ✅ Multi-agent система
│   │   ├── kag_solver/    ✅ KAG reasoning
│   │   ├── security/      ✅ Guardrails
│   │   └── ethics/        ✅ Этическая валидация
│   ├── components/        ✅ React компоненты
│   ├── integration/       ✅ Внешние интеграции
│   ├── benchmark/         ✅ Benchmark пайплайны
│   └── promptops/         ✅ PromptOps модули
├── docs/                  ✅ Документация
│   ├── architecture/      ✅ Архитектурные схемы
│   ├── presentation/      ✅ Презентации
│   └── roadmap/          ✅ Дорожные карты
├── installer/             ✅ Установочные скрипты
│   ├── app/              ✅ Docker приложение
│   └── data/             ✅ Mission YAML
├── tests/                 ✅ Тесты
└── scripts/               ✅ Вспомогательные скрипты
```

**Оценка:** 85/100 ✅

---

## ❌ Проблемы Структуры

### 1. Критическая проблема: Файлы в корне проекта

**Статус:** 🔴 **КРИТИЧНО**

**Найдено в корне:**
- **50+ .md файлов** (документация должна быть в `docs/`)
- **20+ .py скриптов** (test_*, setup_*, check_*, run_*)
- **10+ .ps1 скриптов** (setup-*, check-*, quick-*)
- **5+ конфигурационных файлов** (cursor_*.json, *.config.js)

**Примеры проблемных файлов:**
```
TERAG111-1/
├── test_*.py (20 файлов)        ❌ Должны быть в tests/scripts/
├── setup_*.py (5 файлов)        ❌ Должны быть в scripts/setup/
├── check_*.py (3 файла)         ❌ Должны быть в scripts/diagnostics/
├── run_*.py (2 файла)           ❌ Должны быть в scripts/run/
├── *.md (50+ файлов)            ❌ Должны быть в docs/
├── cursor_*.json (3 файла)      ❌ Должны быть в .cursor/config/
└── *.config.js (5 файлов)       ⚠️ Можно оставить в корне
```

**Влияние:**
- Сложность навигации
- Загромождение корня проекта
- Нарушение принципов организации кода
- Сложность поиска нужных файлов

**Приоритет:** 🔴 **ВЫСОКИЙ**

---

### 2. Дублирование модулей

**Статус:** 🟡 **СРЕДНИЙ**

**Найдено дублирование:**

1. **KAG Builder:**
   - `src/core/kag_builder.py` ✅ (основной)
   - `src/kag/builder.py` ❌ (дубликат?)
   - `installer/app/modules/graph_updater.py` ⚠️ (частичное дублирование)

2. **Docker Compose:**
   - `docker-compose.yml` ✅ (основной)
   - `docker-compose.kag.yml` ⚠️ (специализированный)
   - `docker-compose.kag-simple.yml` ⚠️ (упрощенный)
   - `installer/docker-compose.yml` ❌ (дубликат?)

3. **API Servers:**
   - `src/api/server.py` ✅ (основной)
   - `src/api/terag_v2_server.py` ✅ (v2.0 - нормально)
   - `installer/app/main.py` ⚠️ (альтернативный?)

**Влияние:**
- Путаница в выборе правильного модуля
- Риск рассинхронизации кода
- Увеличение размера проекта

**Приоритет:** 🟡 **СРЕДНИЙ**

---

### 3. Смешанная структура (src/ + installer/app/)

**Статус:** 🟡 **СРЕДНИЙ**

**Проблема:**
```
TERAG111-1/
├── src/                    ✅ Основной код
│   └── api/
│       └── server.py       ✅ Основной сервер
└── installer/
    └── app/
        ├── main.py         ❌ Альтернативный сервер?
        └── modules/        ❌ Дублирование модулей?
```

**Вопросы:**
- Какой сервер использовать: `src/api/server.py` или `installer/app/main.py`?
- Зачем два набора модулей: `src/core/` и `installer/app/modules/`?
- Как они связаны между собой?

**Рекомендация:**
- Четко определить назначение каждого
- Документировать различия
- Или объединить в одну структуру

**Приоритет:** 🟡 **СРЕДНИЙ**

---

### 4. Неорганизованные скрипты

**Статус:** 🟡 **СРЕДНИЙ**

**Найдено в корне:**
- `test_*.py` (20 файлов) — должны быть в `tests/scripts/` или `scripts/tests/`
- `setup_*.py` (5 файлов) — должны быть в `scripts/setup/`
- `check_*.py` (3 файла) — должны быть в `scripts/diagnostics/`
- `run_*.py` (2 файла) — должны быть в `scripts/run/`
- `*.ps1` (10+ файлов) — должны быть в `scripts/powershell/`

**Текущая структура:**
```
TERAG111-1/
├── test_neo4j_*.py         ❌
├── test_telegram_*.py      ❌
├── setup_env.py            ❌
├── check_env.py            ❌
├── run_TERAG.ps1           ❌
└── scripts/                ✅ (существует, но не используется)
```

**Рекомендация:**
```
scripts/
├── setup/
│   ├── setup_env.py
│   └── setup_telegram.py
├── diagnostics/
│   ├── check_env.py
│   └── check_terag_full_stack.py
├── run/
│   └── run_TERAG.ps1
└── tests/
    ├── test_neo4j_*.py
    └── test_telegram_*.py
```

**Приоритет:** 🟡 **СРЕДНИЙ**

---

### 5. Избыточная документация в корне

**Статус:** 🟢 **НИЗКИЙ**

**Найдено:**
- **50+ .md файлов** в корне проекта
- Многие дублируют информацию из `docs/`

**Примеры:**
```
TERAG111-1/
├── README.md               ✅ (можно оставить)
├── CHANGELOG.md            ✅ (можно оставить)
├── QUICK_START.md          ❌ → docs/QUICK_START.md
├── CURSOR_SETUP_README.md  ❌ → docs/setup/CURSOR_SETUP.md
├── TERAG_*.md (10 файлов)  ❌ → docs/reports/TERAG_*.md
└── *_README.md (15 файлов) ❌ → docs/modules/*_README.md
```

**Рекомендация:**
```
docs/
├── README.md               ✅ (главный)
├── QUICK_START.md          ✅
├── setup/
│   ├── CURSOR_SETUP.md
│   └── DOCKER_SETUP.md
├── modules/
│   ├── TELEGRAM_README.md
│   └── VOICE_MODE_README.md
└── reports/
    ├── TERAG_AUDIT_*.md
    └── TERAG_STATUS_*.md
```

**Приоритет:** 🟢 **НИЗКИЙ**

---

### 6. Отсутствие структуры для конфигураций

**Статус:** 🟡 **СРЕДНИЙ**

**Найдено:**
- `cursor_*.json` (3 файла) в корне
- `*.config.js` (5 файлов) в корне
- `configs/` директория существует, но не используется

**Рекомендация:**
```
configs/
├── cursor/
│   ├── cursor_config.json
│   └── cursor_ollama_config.json
├── frontend/
│   ├── vite.config.ts
│   └── tailwind.config.js
└── backend/
    └── pyproject.toml
```

**Приоритет:** 🟡 **СРЕДНИЙ**

---

## 📊 Метрики Структуры

### Статистика файлов

| Тип файлов | В корне | В поддиректориях | Рекомендация |
|------------|---------|------------------|--------------|
| Python скрипты | 30+ | 100+ | Переместить в `scripts/` |
| Markdown файлы | 50+ | 50+ | Переместить в `docs/` |
| Конфигурации | 10+ | 5+ | Переместить в `configs/` |
| Тесты | 20+ | 50+ | Переместить в `tests/scripts/` |

### Размер проекта

- **Общее количество файлов:** ~500+
- **Файлов в корне:** ~150+ ❌ (должно быть < 20)
- **Директорий:** 30+ ✅
- **Размер кодовой базы:** ~50MB

---

## ✅ Рекомендуемая Структура

### Идеальная организация

```
TERAG111-1/
├── .cursor/                    ✅ Конфигурация Cursor
│   ├── config/                ✅ Конфиги Cursor
│   ├── memory_bank/           ✅ Memory Bank
│   └── rules/                 ✅ Правила проекта
├── configs/                    ✅ Конфигурации
│   ├── cursor/                ✅ Cursor конфиги
│   ├── frontend/               ✅ Frontend конфиги
│   └── backend/                ✅ Backend конфиги
├── docs/                       ✅ Документация
│   ├── architecture/           ✅ Архитектура
│   ├── setup/                  ✅ Инструкции по установке
│   ├── modules/                ✅ Документация модулей
│   ├── reports/                ✅ Отчеты и аудиты
│   └── roadmap/                ✅ Дорожные карты
├── scripts/                    ✅ Скрипты
│   ├── setup/                  ✅ Установка
│   ├── diagnostics/            ✅ Диагностика
│   ├── run/                    ✅ Запуск
│   └── tests/                  ✅ Тестовые скрипты
├── src/                        ✅ Исходный код
│   ├── api/                    ✅ API слой
│   ├── core/                   ✅ Бизнес-логика
│   ├── components/              ✅ React компоненты
│   ├── integration/             ✅ Интеграции
│   └── benchmark/               ✅ Benchmark
├── installer/                   ✅ Установщик
│   ├── app/                     ✅ Docker приложение
│   └── data/                    ✅ Mission YAML
├── tests/                       ✅ Тесты
│   ├── unit/                    ✅ Unit тесты
│   ├── integration/             ✅ Integration тесты
│   └── e2e/                     ✅ E2E тесты
├── data/                        ✅ Данные
│   ├── graph_results/           ✅ Результаты графа
│   └── docs/                    ✅ Исходные документы
├── .gitignore                   ✅ Git ignore
├── README.md                    ✅ Главный README
├── CHANGELOG.md                 ✅ История изменений
├── requirements.txt              ✅ Python зависимости
├── package.json                 ✅ Node.js зависимости
└── docker-compose.yml            ✅ Docker Compose
```

**Оценка:** 95/100 ✅

---

## 🎯 План Исправления

### Фаза 1: Критические исправления (1-2 дня)

**Приоритет:** 🔴 **ВЫСОКИЙ**

1. **Переместить скрипты в `scripts/`**
   ```bash
   # Создать структуру
   mkdir -p scripts/{setup,diagnostics,run,tests}
   
   # Переместить файлы
   mv test_*.py scripts/tests/
   mv setup_*.py scripts/setup/
   mv check_*.py scripts/diagnostics/
   mv run_*.py scripts/run/
   mv *.ps1 scripts/powershell/
   ```

2. **Переместить документацию в `docs/`**
   ```bash
   # Создать структуру
   mkdir -p docs/{setup,modules,reports}
   
   # Переместить файлы
   mv *_README.md docs/modules/
   mv TERAG_*.md docs/reports/
   mv CURSOR_*.md docs/setup/
   ```

3. **Организовать конфигурации**
   ```bash
   # Создать структуру
   mkdir -p configs/{cursor,frontend,backend}
   
   # Переместить файлы
   mv cursor_*.json configs/cursor/
   mv *.config.js configs/frontend/
   ```

### Фаза 2: Устранение дублирования (2-3 дня)

**Приоритет:** 🟡 **СРЕДНИЙ**

1. **Анализ дублирования KAG Builder**
   - Определить, какой модуль основной
   - Объединить или удалить дубликаты
   - Обновить импорты

2. **Унификация Docker Compose**
   - Оставить основной `docker-compose.yml`
   - Специализированные в `docker/` директории
   - Документировать различия

3. **Разделение src/ и installer/app/**
   - Четко определить назначение каждого
   - Документировать в `docs/architecture/`
   - Или объединить в одну структуру

### Фаза 3: Оптимизация структуры (1 день)

**Приоритет:** 🟢 **НИЗКИЙ**

1. **Создать `.cursor/config/` для конфигов Cursor**
2. **Организовать `docs/` по категориям**
3. **Добавить `scripts/README.md` с описанием скриптов**

---

## 📋 Чек-лист Исправлений

### Критические (🔴)

- [ ] Переместить все `test_*.py` в `scripts/tests/`
- [ ] Переместить все `setup_*.py` в `scripts/setup/`
- [ ] Переместить все `check_*.py` в `scripts/diagnostics/`
- [ ] Переместить все `*.ps1` в `scripts/powershell/`
- [ ] Переместить документацию в `docs/`
- [ ] Организовать конфигурации в `configs/`

### Важные (🟡)

- [ ] Разрешить дублирование KAG Builder
- [ ] Унифицировать Docker Compose файлы
- [ ] Документировать различия src/ и installer/app/
- [ ] Обновить все импорты после перемещения

### Желательные (🟢)

- [ ] Создать `scripts/README.md`
- [ ] Добавить `.cursor/config/` структуру
- [ ] Организовать `docs/` по категориям
- [ ] Обновить `.gitignore` для новой структуры

---

## 📊 Метрики Улучшения

### До исправлений

- Файлов в корне: **150+** ❌
- Организация: **3/5** ⚠️
- Навигация: **Сложная** ❌

### После исправлений (ожидаемо)

- Файлов в корне: **< 20** ✅
- Организация: **5/5** ✅
- Навигация: **Простая** ✅

---

## 🎯 Рекомендации на Будущее

### 1. Принципы организации

- **Один файл — одно место** — не дублировать файлы
- **Логическая группировка** — связанные файлы вместе
- **Минимум в корне** — только критически важные файлы
- **Документировать структуру** — в `docs/STRUCTURE.md`

### 2. Автоматизация

- **Pre-commit hooks** — проверка структуры перед коммитом
- **CI/CD проверки** — валидация структуры в CI
- **Скрипты миграции** — автоматическое перемещение файлов

### 3. Документация

- **STRUCTURE.md** — описание структуры проекта
- **CONTRIBUTING.md** — правила добавления новых файлов
- **README.md в каждой директории** — описание назначения

---

## ✅ Заключение

### Текущее состояние

**Оценка:** 75/100 ⚠️

**Основные проблемы:**
1. ❌ Много файлов в корне (150+)
2. ❌ Неорганизованные скрипты
3. ⚠️ Дублирование модулей
4. ⚠️ Смешанная структура

### После исправлений (ожидаемо)

**Оценка:** 90/100 ✅

**Улучшения:**
1. ✅ Чистый корень проекта (< 20 файлов)
2. ✅ Организованные скрипты в `scripts/`
3. ✅ Устранено дублирование
4. ✅ Четкая структура

---

**Дата аудита:** 2026-01-06  
**Следующий аудит:** После исправлений (через 1 неделю)  
**Ответственный:** TERAG Development Team
