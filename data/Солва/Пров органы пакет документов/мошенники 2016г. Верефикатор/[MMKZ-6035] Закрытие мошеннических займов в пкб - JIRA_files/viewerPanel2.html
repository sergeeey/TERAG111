<!DOCTYPE html>
<!-- saved from url=(0269)https://www.draw.io/connect/jira/viewerPanel2.html?issueId=73701&xdm_e=https%3A%2F%2Fmoneyman-jira.atlassian.net&xdm_c=channel-com.mxgraph.jira.plugins.drawio__drawioViewerPanel&cp=&xdm_deprecated_addon_key_do_not_use=com.mxgraph.jira.plugins.drawio&lic=none&cv=1.595.0 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Draw.io Viewer</title>
<style type="text/css">
html, body {
	height:100%;
	overflow:hidden;
}
body {
	font-family:Arial,sans-serif;
	width:100%;
	margin:0;
}
</style>
<style type="text/css"></style><style type="text/css">div.mxTooltip {
-webkit-box-shadow: 3px 3px 12px #C0C0C0;
-moz-box-shadow: 3px 3px 12px #C0C0C0;
box-shadow: 3px 3px 12px #C0C0C0;
background: #FFFFCC;
border-style: solid;
border-width: 1px;
border-color: black;
font-family: Arial;
font-size: 8pt;
position: absolute;
cursor: default;
padding: 4px;
color: black;}
td.mxPopupMenuIcon div {
width:16px;
height:16px;}
html div.mxPopupMenu {
-webkit-box-shadow:2px 2px 3px #d5d5d5;
-moz-box-shadow:2px 2px 3px #d5d5d5;
box-shadow:2px 2px 3px #d5d5d5;
_filter:progid:DXImageTransform.Microsoft.DropShadow(OffX=2, OffY=2, Color='#d0d0d0',Positive='true');
background:white;
position:absolute;
border:3px solid #e7e7e7;
padding:3px;}
html table.mxPopupMenu {
border-collapse:collapse;
margin:0px;}
html td.mxPopupMenuItem {
padding:7px 30px 7px 30px;
font-family:Helvetica Neue,Helvetica,Arial Unicode MS,Arial;
font-size:10pt;}
html td.mxPopupMenuIcon {
background-color:white;
padding:0px;}
td.mxPopupMenuIcon .geIcon {
padding:2px;
padding-bottom:4px;
margin:2px;
border:1px solid transparent;
opacity:0.5;
_width:26px;
_height:26px;}
td.mxPopupMenuIcon .geIcon:hover {
border:1px solid gray;
border-radius:2px;
opacity:1;}
html tr.mxPopupMenuItemHover {
background-color: #eeeeee;
color: black;}
table.mxPopupMenu hr {
color:#cccccc;
background-color:#cccccc;
border:none;
height:1px;}
table.mxPopupMenu tr {	font-size:4pt;}
.geDialog { font-family:Helvetica Neue,Helvetica,Arial Unicode MS,Arial;
font-size:10pt;
border:none;
margin:0px;}
.geDialog {	position:absolute;	background:white;	overflow:hidden;	padding:30px;	border:1px solid #acacac;	-webkit-box-shadow:0px 0px 2px 2px #d5d5d5;	-moz-box-shadow:0px 0px 2px 2px #d5d5d5;	box-shadow:0px 0px 2px 2px #d5d5d5;	_filter:progid:DXImageTransform.Microsoft.DropShadow(OffX=2, OffY=2, Color='#d5d5d5', Positive='true');	z-index: 2;}.geDialogClose {	position:absolute;	width:9px;	height:9px;	opacity:0.5;	cursor:pointer;	_filter:alpha(opacity=50);}.geDialogClose:hover {	opacity:1;}.geDialogTitle {	box-sizing:border-box;	white-space:nowrap;	background:rgb(229, 229, 229);	border-bottom:1px solid rgb(192, 192, 192);	font-size:15px;	font-weight:bold;	text-align:center;	color:rgb(35, 86, 149);}.geDialogFooter {	background:whiteSmoke;	white-space:nowrap;	text-align:right;	box-sizing:border-box;	border-top:1px solid #e5e5e5;	color:darkGray;}
.geBtn {	background-color: #f5f5f5;	border-radius: 2px;	border: 1px solid #d8d8d8;	color: #333;	cursor: default;	font-size: 11px;	font-weight: bold;	height: 29px;	line-height: 27px;	margin: 0 0 0 8px;	min-width: 72px;	outline: 0;	padding: 0 8px;	cursor: pointer;}.geBtn:hover, .geBtn:focus {	-webkit-box-shadow: 0px 1px 1px rgba(0,0,0,0.1);	-moz-box-shadow: 0px 1px 1px rgba(0,0,0,0.1);	box-shadow: 0px 1px 1px rgba(0,0,0,0.1);	border: 1px solid #c6c6c6;	background-color: #f8f8f8;	background-image: linear-gradient(#f8f8f8 0px,#f1f1f1 100%);	color: #111;}.geBtn:disabled {	opacity: .5;}.gePrimaryBtn {	background-color: #4d90fe;	background-image: linear-gradient(#4d90fe 0px,#4787ed 100%);	border: 1px solid #3079ed;	color: #fff;}.gePrimaryBtn:hover, .gePrimaryBtn:focus {	background-color: #357ae8;	background-image: linear-gradient(#4d90fe 0px,#357ae8 100%);	border: 1px solid #2f5bb7;	color: #fff;}.gePrimaryBtn:disabled {	opacity: .5;}</style><script data-options="resize:false;margin:false" src="./all.js.Без названия"></script><link type="text/css" rel="stylesheet" href="./all.css"><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body><div id="MathJax_Message" style="display: none;"></div>
<script type="text/javascript">
//Parses URL parameters
function getUrlParam(param)
{
	var result = (new RegExp(param + '=([^&]*)')).exec(window.location.search);
	
	if (result != null && result.length > 0)
	{
		return decodeURIComponent(result[1].replace(/\+/g, '%20'))
	}
	
	return null;
};

function getBaseUrl()
{
	var baseUrl = getUrlParam('xdm_e', true) + getUrlParam('cp', true);
	//Ensure baseUrl belongs to attlasian (*.jira.com and *.atlassian.net)
	//Since we add cp to xdm_e, we had to ensure that there is a slash after the domain. Since if xdm_e is ok, cp can corrupt is such as cp = '.fakedomain.com' such that baseUrl is atlassian.net.fakedomain.com
	if (/^https:\/\/([^\.])+\.jira\.com\//.test(baseUrl + '/') || /^https:\/\/([^\.])+\.atlassian\.net\//.test(baseUrl + '/')) 
	{
		return baseUrl;
	}
	throw 'Invalid baseUrl!';
};

// Sets global environment variables
RESOURCE_BASE = '/resources/dia';
STENCIL_PATH = '/stencils';
SHAPES_PATH = '/shapes';

// Overrides browser language with JIRA user language
var lang = getUrlParam('loc');

// Language is in the Connect URL
if (lang != null)
{
	var dash = lang.indexOf('-');
	
	if (dash >= 0)
	{
		mxLanguage = lang.substring(0, dash);
	}
}
</script>
<script src="./viewer.min.js.Без названия" type="text/javascript"></script><script type="text/javascript" src="./MathJax.js.Без названия"></script>
<script type="text/javascript">
(function()
{
	// Enables dynamic loading of shapes and stencils (same domain)
	mxStencilRegistry.dynamicLoading = true;

	// Specifies connection mode for touch devices (at least one should be true)
	var connectUrl = getBaseUrl() + '/atlassian-connect';
	var head = document.getElementsByTagName("head")[0];
	
	var script = document.createElement("script");
	script.setAttribute('data-options', 'resize:false;margin:false');

	head.appendChild(script);
	
	var link = document.createElement("link");
	link.type = "text/css";
	link.rel = "stylesheet";
	link.href = connectUrl + '/all.css';
	head.appendChild(link);
	
	mxResources.loadDefaultBundle = false;
	var bundle = mxResources.getDefaultBundle(RESOURCE_BASE, mxLanguage) ||
		mxResources.getSpecialBundle(RESOURCE_BASE, mxLanguage);

	// Prefetches asynchronous requests so that below code runs synchronous
	// Loading the correct bundle (one file) via the fallback system in mxResources. The stylesheet
	// is compiled into JS in the build process and is only needed for local development.
	var bundleLoaded = false;
	var scriptLoaded = false;
	
	function mainBarrier()
	{
		if (bundleLoaded && scriptLoaded)
		{
			main();
		}
	};
	
	mxUtils.getAll([bundle], function(xhr)
	{
		// Adds bundle text to resources
		mxResources.parse(xhr[0].getText());
		bundleLoaded = true;
		mainBarrier();
	});

	script.onload = function()
	{
		scriptLoaded = true;
		mainBarrier();
	};
	script.src = 'https://connect-cdn.atl-paas.net/all.js';
	
	function main()
	{
		var editImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVBAMAAABbObilAAAAD1BMVEUAAAAAAAAQEBBycnIgICBqwj3hAAAAAXRSTlMAQObYZgAAADlJREFUCNdjoBwoChrAmCyGggJwYWVBBSiTSVDICKFa0AEuLCiEJKyAX5gBSZgBSZgBKGwMBKQ7HAAWzQSfKKAyBgAAAABJRU5ErkJggg==';
		var removeImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVAQMAAACT2TfVAAAABlBMVEUAAAAAAAClZ7nPAAAAAXRSTlMAQObYZgAAABlJREFUCNdjQAF/GBj4/x8AYxBg/k80RgYApAUPr950a4AAAAAASUVORK5CYII=';
		var issueId = getUrlParam('issueId');
		var serverName = document.referrer;
		var timeout = 25000;
		var index1 = serverName.indexOf('//');
		
		if (index1 > 0)
		{
			var index2 = serverName.indexOf('/', index1 + 2);
			
			if (index2 > index1)
			{
				serverName = serverName.substring(index1 + 2, index2);
			}
		}
		
		// Delayed invocation see below
		function init()
		{
			// Workaround to ignore scrollbars when applying fit to available width in all but FF
			if (!mxClient.IS_FF)
			{
				document.body.style.width = document.documentElement.offsetWidth + 'px';
			}
			
			AP.resize('100%', '0px');
			AP.require(['request', 'dialog', 'jira'], function(request, dialog, jira) 
			{
				request({
					url: '/rest/api/2/issue/' + issueId + '?fields=attachment',
					type: 'GET',
					success: function(resp) 
					{
						var tbHeight = GraphViewer.prototype.toolbarHeight;
						var containers = [];
						var count = 0;
						
						function updateHeight()
						{
							var h = 0;

							// +2 is needed to include margin
							for (var i = 0; i < containers.length; i++)
							{
								h += containers[i].offsetHeight + tbHeight + 2;
							}
							
							// Restricts the max sidebar panel height
							h = Math.min(screen.height * 1.5, h);
							AP.resize('100%', h);
							
							// Workaround for iframe scrollbars
							document.body.style.height = h + 'px';
						}
						
						function finish() 
						{
							count--;
							
			 				if (count == 0) 
			 				{
			 					document.body.style.width = '';
								updateHeight();
			 				}
						}
	
						function loadDiagram(value)
						{
							count++;
							var container = document.createElement('div');
							container.style.cssText = 'position:relative;box-sizing:border-box;margin-bottom:2px;' +
								'max-width:100%;min-width:100%;border:1px solid transparent;';
								
							// Adds filename and ID to side panel
							var title = document.createElement('div');
							title.innerHTML = '&ndash; ';
							mxUtils.write(title, value.filename + ' [' + value.id + ']');
							var displayName = value.author != null ? value.author.displayName : '';
							title.setAttribute('title', value.filename + ' [' + value.id + '] - ' + displayName +
									' ' + new Date(value.created).toLocaleString());
							title.style.cssText = 'position:relative;box-sizing:border-box;width:100%;padding-top:6px;height:' + tbHeight +
								'px;margin-bottom:-' + tbHeight + 'px;text-align:left;white-space:nowrap;cursor:pointer;';
							document.body.appendChild(title);
							
							// Simple collapse-expand for diagrams
							title.addEventListener('click', function()
							{
								if (container.style.display != 'none')
								{
									title.innerHTML = '+ ';
									mxUtils.write(title, value.filename + ' [' + value.id + ']');
									container.style.display = 'none';
									title.style.marginBottom = '0px';
								}
								else
								{
									title.innerHTML = '&ndash; ';
									mxUtils.write(title, value.filename + ' [' + value.id + ']');
									container.style.display = '';
									title.style.marginBottom = -tbHeight + 'px';
								}
								
								updateHeight();
							});
							
							document.body.appendChild(container);
							containers.push(container);
							var acceptResponse = true;
							
							var timeoutThread = window.setTimeout(function()
							{
								acceptResponse = false;
								
	 							container.style.height = '24px';
	 							container.style.textAlign = 'center';
	 							container.style.marginTop = tbHeight + 'px';
	 							mxUtils.write(container, 'The connection has timed out: The server at ' +
										serverName + ' is taking too long to respond.');
	 							finish();
							}, timeout);
							
							// Loads attachment content
							request({
								url: '/secure/attachment/' + value.id + '/',
								success: function(xml)
								{
							 		window.clearTimeout(timeoutThread);
									
							 		if (acceptResponse)
							 		{
										var doc = mxUtils.parseXml(xml);
			
										var btnDefs = {
											'edit': {title: mxResources.get('edit'), enabled: typeof window.Blob !== 'undefined',
												image: editImage, handler: function()
											{
												dialog.create(
												{
												   key: 'drawioEditor',
												   width: '100%',
												   height: '100%',
												   chrome: false,
												   customData : {diagramName: value.filename, diagramId: value.id, page: viewer.currentPage}
												});
											}},
											'remove': {title: mxResources.get('delete'), image: removeImage, handler: function()
											{
												if (confirm(mxResources.get('removeIt', [value.filename]) + '?'))
												{
									    	        request({
									    	            url: '/rest/api/2/attachment/' + value.id,
									    	            type: 'DELETE',
									    	            success: function()
									    	            {
									    	            	jira.refreshIssuePage();
									    	            },
									    	            error : function()
									    	            {
									    	            	jira.refreshIssuePage();
									    	            }
									    	        });
												}
											}}
										};
										
										var viewer = new GraphViewer(container, doc.documentElement, {highlight: '#3572b0',
											'toolbar-position': 'top', toolbar: 'edit pages layers lightbox remove', 'max-height':
											Math.max(280, document.documentElement.offsetWidth / 1.5), border: 8,
											/* disables automatic zoom with no buttons */'auto-fit': false,
											nav: true, title: value.filename + ' [' + value.id + ']', 'toolbar-buttons': btnDefs});
										
										// Handles resize of iframe after zoom
										var graphDoResizeContainer = viewer.graph.doResizeContainer;
										
										viewer.graph.doResizeContainer = function(width, height)
										{
											graphDoResizeContainer.apply(this, arguments);
											updateHeight();
										};
										
										// Updates the size of the iframe in responsive cases
										viewer.updateContainerHeight = function(container, height)
										{
											updateHeight();
										};
			
										viewer.showLightbox = function()
										{
											dialog.create(
											{
							                   header: value.filename + ' [' + value.id + ']',
											   key: 'drawioFullScreenViewer',
							                   size: 'fullscreen',
											   chrome: true,
											   customData: {diagramName: value.filename, diagramId: value.id, page: viewer.currentPage}
											});					
										};
										
										finish();
							 		}
								},
								error: mxUtils.bind(this,  function(err, statusText, exc) 
								{
							 		window.clearTimeout(timeoutThread);
									
							 		if (acceptResponse)
							 		{
										container.style.height = '24px';
										container.style.textAlign = 'center';
										container.style.marginTop = tbHeight + 'px';
										mxUtils.write(container, 'Error: ' + err.status);
										finish();
							 		}
							    })
							});
						};
						
						var respObj = JSON.parse(resp);
						
						for (var i = 0; i < respObj.fields.attachment.length; i++)
						{
							var attachment = respObj.fields.attachment[i];
							
							if (attachment.mimeType == 'application/drawio')
							{
								loadDiagram(attachment);
							}
						}
						
						// Shows message if no files are found
						if (count == 0)
						{
							mxUtils.write(document.body, mxResources.get('noFiles'));
							AP.resize('100%', '20px');
						}
					},
					error: function() 
					{
						AP.resize('100%', '0px');
					}
				});
			});
		}; // end of init
		
		// Workaround for collapsed side panel is to delay init until size is not 0
		// NOTE: Since container.offsetWidth is 2 in this case the delayed rendering
		// in the viewer does not triggger. We disable is here to make sure this does
		// not change in case the container width is zero in the future.
		GraphViewer.prototype.checkVisibleState = false;
		
		if (document.documentElement.offsetWidth == 0)
		{
			var listener = function()
			{
				if (document.documentElement.offsetWidth > 0)
				{
					window.removeEventListener('resize', listener);
					init();
				}
			};
			
			window.addEventListener('resize', listener);
		}
		else
		{
			init();
		}
	}
})();
</script>


</body></html>