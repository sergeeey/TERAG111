<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERAG Environment Audit Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .score-display {
            text-align: center;
            margin: 20px 0;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            position: relative;
            background: conic-gradient(var(--score-color) var(--score-angle), #e0e0e0 var(--score-angle));
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
        }

        .score-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--score-color);
            z-index: 1;
        }

        .score-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-critical {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #ffcdd2;
        }

        .status-warning {
            background: #fff3e0;
            color: #ef6c00;
            border: 2px solid #ffcc02;
        }

        .status-good {
            background: #e8f5e8;
            color: #2e7d32;
            border: 2px solid #c8e6c9;
        }

        .status-excellent {
            background: #e3f2fd;
            color: #1565c0;
            border: 2px solid #bbdefb;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .issues-list {
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .issue-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            border-left: 4px solid #ff5722;
            background: #fff3e0;
        }

        .issue-critical {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .issue-warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }

        .issue-info {
            border-left-color: #2196f3;
            background: #e3f2fd;
        }

        .recommendations {
            background: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .recommendations h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .recommendation-item {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .recommendation-item:last-child {
            border-bottom: none;
        }

        .refresh-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .timestamp {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 20px;
        }

        .chart-container {
            height: 300px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç TERAG Environment Audit</h1>
            <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è Cursor IDE –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</p>
        </div>

        <button class="refresh-btn" onclick="refreshDashboard()">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        </button>

        <div id="dashboard" class="dashboard-grid">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏—Ç–∞...</p>
            </div>
        </div>

        <div class="timestamp" id="lastUpdate">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∑–∞–≥—Ä—É–∑–∫–∞...
        </div>
    </div>

    <script>
        let auditData = null;

        function getScoreColor(score) {
            if (score >= 0.8) return '#4caf50'; // –ó–µ–ª—ë–Ω—ã–π
            if (score >= 0.6) return '#2196f3'; // –°–∏–Ω–∏–π
            if (score >= 0.4) return '#ff9800'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
            return '#f44336'; // –ö—Ä–∞—Å–Ω—ã–π
        }

        function getScoreStatus(score) {
            if (score >= 0.8) return { class: 'status-excellent', text: '–û—Ç–ª–∏—á–Ω–æ' };
            if (score >= 0.6) return { class: 'status-good', text: '–•–æ—Ä–æ—à–æ' };
            if (score >= 0.4) return { class: 'status-warning', text: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ' };
            return { class: 'status-critical', text: '–ö—Ä–∏—Ç–∏—á–Ω–æ' };
        }

        function getScoreAngle(score) {
            return score * 360;
        }

        function formatScore(score) {
            return (score * 100).toFixed(1) + '%';
        }

        function createScoreCard(title, score, icon, details = {}) {
            const status = getScoreStatus(score);
            const color = getScoreColor(score);
            const angle = getScoreAngle(score);

            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">${icon}</div>
                        <div class="card-title">${title}</div>
                    </div>
                    <div class="score-display">
                        <div class="score-circle" style="--score-color: ${color}; --score-angle: ${angle}deg">
                            <div class="score-value">${formatScore(score)}</div>
                        </div>
                        <div class="score-label">${status.text}</div>
                        <div class="status-badge ${status.class}">${status.text}</div>
                    </div>
                    ${Object.keys(details).length > 0 ? `
                        <div class="metrics-grid">
                            ${Object.entries(details).map(([key, value]) => `
                                <div class="metric-item">
                                    <div class="metric-value">${value}</div>
                                    <div class="metric-label">${key}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function createIssuesCard(issues, recommendations) {
            const issuesHtml = issues.map(issue => `
                <div class="issue-item ${issue.severity === 'critical' ? 'issue-critical' : 
                    issue.severity === 'warning' ? 'issue-warning' : 'issue-info'}">
                    <strong>${issue.title}</strong><br>
                    <small>${issue.description}</small>
                </div>
            `).join('');

            const recommendationsHtml = recommendations.map(rec => `
                <div class="recommendation-item">
                    <strong>${rec.title}:</strong> ${rec.description}
                </div>
            `).join('');

            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚ö†Ô∏è</div>
                        <div class="card-title">–ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</div>
                    </div>
                    ${issues.length > 0 ? `
                        <h4>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (${issues.length}):</h4>
                        <div class="issues-list">${issuesHtml}</div>
                    ` : '<p>‚úÖ –ü—Ä–æ–±–ª–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>'}
                    ${recommendations.length > 0 ? `
                        <div class="recommendations">
                            <h4>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (${recommendations.length}):</h4>
                            ${recommendationsHtml}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function createEnvironmentDetailsCard(envData) {
            const checks = envData.checks || {};
            
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üîß</div>
                        <div class="card-title">–î–µ—Ç–∞–ª–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è</div>
                    </div>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-value">${envData.active_workspace || 'N/A'}</div>
                            <div class="metric-label">–ê–∫—Ç–∏–≤–Ω–æ–µ —Ä–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value">${envData.projects_found || 0}</div>
                            <div class="metric-label">–ù–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value">${envData.active_mcp?.length || 0}</div>
                            <div class="metric-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö MCP</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-value">${envData.total_issues || 0}</div>
                            <div class="metric-label">–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º</div>
                        </div>
                    </div>
                    ${envData.active_mcp && envData.active_mcp.length > 0 ? `
                        <h4>–ê–∫—Ç–∏–≤–Ω—ã–µ MCP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:</h4>
                        <ul>
                            ${envData.active_mcp.map(mcp => `<li>${mcp}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
            `;
        }

        async function loadAuditData() {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á—ë—Ç environment-–∞—É–¥–∏—Ç–∞
                const response = await fetch('/api/audit/latest');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                auditData = await response.json();
                return auditData;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                return null;
            }
        }

        function renderDashboard(data) {
            if (!data) {
                document.getElementById('dashboard').innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">‚ùå</div>
                            <div class="card-title">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
                        </div>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API.</p>
                    </div>
                `;
                return;
            }

            const dashboard = document.getElementById('dashboard');
            const cards = [];

            // –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ environment-–∞—É–¥–∏—Ç–∞
            if (data.environment_score !== undefined) {
                cards.push(createScoreCard(
                    'Environment Score',
                    data.environment_score,
                    'üîç',
                    {
                        '–ü—Ä–æ–±–ª–µ–º—ã': data.total_issues || 0,
                        '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏': data.total_recommendations || 0,
                        '–°—Ç–∞—Ç—É—Å': data.status || 'unknown'
                    }
                ));
            }

            // –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
            if (data.issues || data.recommendations) {
                cards.push(createIssuesCard(
                    data.issues || [],
                    data.recommendations || []
                ));
            }

            // –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–µ—Ç–∞–ª–µ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
            cards.push(createEnvironmentDetailsCard(data));

            dashboard.innerHTML = cards.join('');
        }

        async function refreshDashboard() {
            const dashboard = document.getElementById('dashboard');
            dashboard.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</p>
                </div>
            `;

            const data = await loadAuditData();
            renderDashboard(data);
            
            document.getElementById('lastUpdate').textContent = 
                `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date().toLocaleString('ru-RU')}`;
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(refreshDashboard, 30000);

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', refreshDashboard);
    </script>
</body>
</html>



































