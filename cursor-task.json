{
  "version": "1.0",
  "name": "TERAG Local Cloud Launcher",
  "description": "–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é TERAG Cloud: –∑–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –∑–Ω–∞–Ω–∏–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI-REPS –∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥.",
  "variables": {
    "PY": "python",
    "PORT": "8000",
    "DOC_PATH": "data/docs",
    "DB_PATH": "data/journal/journal.jsonl"
  },
  "steps": [
    {
      "id": "0-structure",
      "title": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞",
      "summary": "–°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫–∏ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –¥–∞–Ω–Ω—ã—Ö –∏ –∂—É—Ä–Ω–∞–ª–æ–≤.",
      "files": [
        { "path": "data/docs/.keep", "content": "" },
        { "path": "data/indexes/.keep", "content": "" },
        { "path": "data/journal/.keep", "content": "" },
        { "path": "src/api/static/upload.html", "content": "" }
      ],
      "verify": [
        "test -d data/docs && test -d data/journal && test -d data/indexes"
      ]
    },
    {
      "id": "1-ingestor",
      "title": "–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
      "summary": "–î–æ–±–∞–≤–ª—è–µ–º terag_ingest.py ‚Äî —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞ –∑–Ω–∞–Ω–∏–π.",
      "files": [
        {
          "path": "terag_ingest.py",
          "content": "#!/usr/bin/env python3\nimport os, asyncio\nfrom src.core.kag_builder import KAGBuilder\n\nasync def main():\n    docs = [os.path.join('data/docs', f) for f in os.listdir('data/docs') if f.lower().endswith(('.txt','.md','.pdf','.docx'))]\n    if not docs:\n        print('‚ö†Ô∏è –ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ data/docs/')\n        return\n    async with KAGBuilder(\n        openspg_url='http://localhost:8080',\n        neo4j_url='bolt://localhost:7687',\n        supabase_url='postgresql://postgres:password@localhost:5432/terag'\n    ) as kag:\n        for doc in docs:\n            result = await kag.process_document(doc, 'markdown')\n            print(f\"üìÑ {doc}: {result.get('triplets_count',0)} —Ç—Ä–∏–ø–ª–µ—Ç–æ–≤, –≥—Ä–∞—Ñ {result.get('graph_id')}\")\n\nif __name__ == '__main__':\n    asyncio.run(main())\n"
        }
      ],
      "verify": [
        "${PY} terag_ingest.py || true"
      ]
    },
    {
      "id": "2-api-upload",
      "title": "–î–æ–±–∞–≤–ª—è–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã /api/upload –∏ /api/graph",
      "summary": "–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –≥—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π —á–µ—Ä–µ–∑ API.",
      "files": [
        {
          "path": "src/api/server.py",
          "patch": true,
          "content": "from fastapi import FastAPI, UploadFile, File\nimport os, json\nfrom src.core.metrics import get_metrics_snapshot\nfrom src.core.health import get_health\nfrom src.core.self_learning import accept_feedback\n\napp = FastAPI(title='TERAG Local Cloud', version='1.0')\n\nUPLOAD_DIR = 'data/docs'\nGRAPH_FILE = 'data/indexes/graph.json'\nos.makedirs(UPLOAD_DIR, exist_ok=True)\n\n@app.post('/api/upload')\nasync def upload_doc(file: UploadFile = File(...)):\n    path = os.path.join(UPLOAD_DIR, file.filename)\n    with open(path, 'wb') as f:\n        f.write(await file.read())\n    return {'status':'ok','filename':file.filename}\n\n@app.get('/api/graph')\ndef get_graph():\n    if not os.path.exists(GRAPH_FILE):\n        return {'graph':[], 'edges':[]}\n    with open(GRAPH_FILE,'r',encoding='utf-8') as f:\n        return json.load(f)\n"
        }
      ],
      "verify": [
        "${PY} scripts/run_api.py & sleep 2",
        "curl -s -X POST -F 'file=@README.md' http://127.0.0.1:${PORT}/api/upload | grep ok > /dev/null",
        "pkill -f src.api.server || true"
      ]
    },
    {
      "id": "3-ui",
      "title": "–î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞—Ñ–∞",
      "summary": "–°—Ç—Ä–∞–Ω–∏—Ü–∞ upload.html —Å —Ñ–æ—Ä–º–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≥—Ä–∞—Ñ–∞ (D3.js).",
      "files": [
        {
          "path": "src/api/static/upload.html",
          "content": "<!doctype html><html><head><meta charset='utf-8'><title>TERAG Local Cloud</title><style>body{font-family:system-ui;margin:24px}input{margin:8px}svg{border:1px solid #ddd;width:100%;height:600px}</style></head><body><h1>TERAG Local Cloud</h1><p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:</p><input type='file' id='file'><button onclick='upload()'>Upload</button><pre id='msg'></pre><h2>–ì—Ä–∞—Ñ –∑–Ω–∞–Ω–∏–π</h2><svg id='graph'></svg><script src='https://d3js.org/d3.v7.min.js'></script><script>\nasync function upload(){const f=document.getElementById('file').files[0];if(!f)return alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');const fd=new FormData();fd.append('file',f);const r=await fetch('/api/upload',{method:'POST',body:fd});const j=await r.json();document.getElementById('msg').innerText='–ó–∞–≥—Ä—É–∂–µ–Ω: '+j.filename;setTimeout(drawGraph,1000);}\nasync function drawGraph(){const r=await fetch('/api/graph');const g=await r.json();const svg=d3.select('#graph');svg.selectAll('*').remove();const width=svg.node().getBoundingClientRect().width,height=600;const sim=d3.forceSimulation(g.graph).force('link',d3.forceLink(g.edges).distance(100).strength(1).id(d=>d.id)).force('charge',d3.forceManyBody().strength(-300)).force('center',d3.forceCenter(width/2,height/2));const link=svg.append('g').selectAll('line').data(g.edges).enter().append('line').attr('stroke','#999');const node=svg.append('g').selectAll('circle').data(g.graph).enter().append('circle').attr('r',8).attr('fill','#69b').call(drag(sim));const label=svg.append('g').selectAll('text').data(g.graph).enter().append('text').text(d=>d.label).attr('font-size','10px');sim.on('tick',()=>{link.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);node.attr('cx',d=>d.x).attr('cy',d=>d.y);label.attr('x',d=>d.x+10).attr('y',d=>d.y);});function drag(sim){function dragstarted(e){if(!e.active)sim.alphaTarget(0.3).restart();e.subject.fx=e.subject.x;e.subject.fy=e.subject.y;}function dragged(e){e.subject.fx=e.x;e.subject.fy=e.y;}function dragended(e){if(!e.active)sim.alphaTarget(0);e.subject.fx=null;e.subject.fy=null;}return d3.drag().on('start',dragstarted).on('drag',dragged).on('end',dragended);} }</script></body></html>"
        }
      ],
      "verify": [
        "test -f src/api/static/upload.html"
      ]
    },
    {
      "id": "4-run",
      "title": "–ó–∞–ø—É—Å–∫ TERAG Local Cloud",
      "summary": "–ü–æ–¥–Ω–∏–º–∞–µ–º API –∏ UI, —Ç–µ—Å—Ç–∏—Ä—É–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.",
      "run": [
        "${PY} scripts/run_api.py & sleep 3",
        "curl -s http://127.0.0.1:${PORT}/api/metrics | jq .RSS > /dev/null",
        "curl -s http://127.0.0.1:${PORT}/api/upload || true"
      ],
      "verify": [
        "curl -s http://127.0.0.1:${PORT}/api/health | grep -E 'ok|warning|critical' > /dev/null"
      ],
      "finally": [
        "echo '‚ú® TERAG Local Cloud –∑–∞–ø—É—â–µ–Ω! –û—Ç–∫—Ä–æ–π http://127.0.0.1:8000/api/static/upload.html'; true"
      ]
    }
  ],
  "success_criteria": [
    "–°–µ—Ä–≤–µ—Ä FastAPI —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8000",
    "–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã /api/upload –∏ /api/graph –∞–∫—Ç–∏–≤–Ω—ã",
    "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ",
    "–î–∞—à–±–æ—Ä–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É /api/static/upload.html"
  ]
}