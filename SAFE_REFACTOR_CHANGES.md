# üîí Safe Refactor - –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º (SAFE_MODE) –≤ TERAG –∏ –≤–∫–ª—é—á–∞–µ—Ç –∑–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

## üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### 1. `src/core/config.py`
–ú–æ–¥—É–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —Ä–µ–∂–∏–º–æ–º:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ (whitelist)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –°–∏–º—É–ª—è—Ü–∏—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 2. `installer/app/modules/safe_request.py`
–û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤:
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å `SafeConfig`
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã –≤ SAFE_MODE
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 3. `.pre-commit-config.yaml`
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pre-commit hooks:
- **gitleaks** - –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ
- **bandit** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Python –∫–æ–¥–∞
- **black/isort/flake8** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª–∏–Ω—Ç–∏–Ω–≥
- **prettier** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON/YAML/Markdown

### 4. `setup-pre-commit.sh` / `setup-pre-commit.ps1`
–°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ pre-commit hooks

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `README.md`
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "Security Notice" —Å:
- –û–ø–∏—Å–∞–Ω–∏–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –æ–± –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- –°—Å—ã–ª–∫–æ–π –Ω–∞ SECURITY.md

### 2. `env.example`
–†–∞—Å—à–∏—Ä–µ–Ω —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ SAFE_MODE
- –õ–∏–º–∏—Ç—ã –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 3. `installer/app/modules/brave_search.py`
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω `safe_request` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ Brave Search API

### 4. `installer/app/modules/bright_extractor.py`
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω `safe_request` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –ø–µ—Ä–µ–¥ –≤–µ–±-—Å–∫—Ä–µ–π–ø–∏–Ω–≥–æ–º

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit hooks

**Linux/Mac:**
```bash
chmod +x setup-pre-commit.sh
./setup-pre-commit.sh
```

**Windows:**
```powershell
.\setup-pre-commit.ps1
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**
```bash
pip install pre-commit
pre-commit install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `env.example` –≤ `.env`:
```bash
cp env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:
- `SAFE_MODE=true` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω)
- `ALLOWED_EXTERNAL_DOMAINS` - —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- `MAX_EXTERNAL_REQUESTS_PER_MINUTE` - –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
python -c "from src.core.config import get_config; print(get_config().get_config_dict())"

# –¢–µ—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
export SAFE_MODE=true
python -c "from src.core.config import get_config; c = get_config(); print(c.is_external_request_allowed('https://example.com'))"
```

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –∫–æ–¥–µ Python

```python
from src.core.config import get_config

config = get_config()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
allowed, reason = config.is_external_request_allowed("https://api.example.com")
if not allowed:
    print(f"Request blocked: {reason}")
```

### –í –º–æ–¥—É–ª—è—Ö –≤–µ–±-–∑–∞–ø—Ä–æ—Å–æ–≤

```python
from modules.safe_request import safe_request

response, error = safe_request("GET", "https://api.example.com")
if error:
    print(f"Error: {error}")
else:
    data = response.json()
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

Pre-commit hooks –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç:
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ (gitleaks)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Python –∫–æ–¥–∞ (bandit)
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (black, isort, prettier)
- ‚úÖ –õ–∏–Ω—Ç–∏–Ω–≥ (flake8)

–î–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
pre-commit run --all-files
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **SAFE_MODE –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω** - —ç—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. **–í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è** - –¥–ª—è –∞—É–¥–∏—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. **Whitelist –¥–æ–º–µ–Ω–æ–≤** - —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–ø—Ä–æ—à–µ–Ω—ã
4. **Pre-commit hooks –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –∫–æ–º–º–∏—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤

## üêõ Troubleshooting

### "SAFE_MODE: Domain not allowed"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `ALLOWED_EXTERNAL_DOMAINS` –≤ `.env`
- –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –≤ whitelist, –µ—Å–ª–∏ —ç—Ç–æ –ª–µ–≥–∏—Ç–∏–º–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- –ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ SAFE_MODE –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: `SAFE_MODE=false`

### "ImportError: No module named 'src.core.config'"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- –î–æ–±–∞–≤—å—Ç–µ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ –≤ PYTHONPATH: `export PYTHONPATH=$PWD:$PYTHONPATH`

### Pre-commit hooks –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ hooks —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `pre-commit install`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é pre-commit: `pre-commit --version`
- –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: `pre-commit uninstall && pre-commit install`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [SECURITY.md](SECURITY.md) - –ü–æ–ª–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [README.md](README.md) - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- [.pre-commit-config.yaml](.pre-commit-config.yaml) - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è hooks

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

- [ ] SAFE_MODE –≤–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- [ ] Pre-commit hooks —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] `.env` —Ñ–∞–π–ª –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ .gitignore)
- [ ] –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–µ –≤ –∫–æ–¥–µ
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: `pre-commit run --all-files`
- [ ] README.md –æ–±–Ω–æ–≤–ª–µ–Ω —Å Security Notice

---

**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é!** üöÄ

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
1. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É: `git checkout -b safe-refactor`
2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–æ–Ω–∏ —É–∂–µ –≤ —Ñ–∞–π–ª–∞—Ö)
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pre-commit hooks
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: `pre-commit run --all-files`
5. –ö–æ–º–º–∏—Ç—å—Ç–µ: `git commit -m "feat: Add SAFE_MODE and security enhancements"`


















